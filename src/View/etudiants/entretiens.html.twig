{% extends 'layout.html.twig' %}
{% block title %}Mes entretiens
	{{ parent() }}
{% endblock %}
{% block content %}

	<link href="../assets/styles/main.css" rel="stylesheet" type="text/css"/>
	<header>
		<div class="userHeader">
			<p>
				Bonjour,
				<span class="user">{{ etudiant.prenom_etudiant }}</span>
			</p>
			<nav class="userHeader__nav">
				<ul>
					<li><a aria-label="DÃ©connexion de votre espace"href="{{ url('/disconnect') }}"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path fill="currentColor" d="M5 21q-.825 0-1.413-.588T3 19V5q0-.825.588-1.413T5 3h7v2H5v14h7v2H5Zm11-4l-1.375-1.45l2.55-2.55H9v-2h8.175l-2.55-2.55L16 7l5 5l-5 5Z"/></svg></a></li>
					<li><a aria-label="Les paramÃ¨tres de votre compte"href="{{url('/etudiant/'~etudiant.id_etudiant~'/profil')}}"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path fill="currentColor" d="M12 12q-1.65 0-2.825-1.175T8 8q0-1.65 1.175-2.825T12 4q1.65 0 2.825 1.175T16 8q0 1.65-1.175 2.825T12 12Zm-8 8v-2.8q0-.85.438-1.563T5.6 14.55q1.55-.775 3.15-1.163T12 13q1.65 0 3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20H4Zm2-2h12v-.8q0-.275-.138-.5t-.362-.35q-1.35-.675-2.725-1.012T12 15q-1.4 0-2.775.338T6.5 16.35q-.225.125-.363.35T6 17.2v.8Zm6-8q.825 0 1.413-.588T14 8q0-.825-.588-1.413T12 6q-.825 0-1.413.588T10 8q0 .825.588 1.413T12 10Zm0-2Zm0 10Z"/></svg></a></li>
					<li><a href="#" aria-label="Les derniÃ¨res informations importantes"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path fill="currentColor" d="M19 17v-5.2c-.5.1-1 .2-1.5.2H17v6H7v-7c0-2.8 2.2-5 5-5c.1-1.3.7-2.4 1.5-3.3c-.3-.4-.9-.7-1.5-.7c-1.1 0-2 .9-2 2v.3C7 5.2 5 7.9 5 11v6l-2 2v1h18v-1l-2-2m-9 4c0 1.1.9 2 2 2s2-.9 2-2h-4M21 6.5c0 1.9-1.6 3.5-3.5 3.5S14 8.4 14 6.5S15.6 3 17.5 3S21 4.6 21 6.5"/></svg></a></li>
				</ul>
			</nav>
		</div>
	</header>

	<section>
		<h2 class="etudMeetings--title">Mes entretiens</h2>
		{% if entreprisesSesEntretiens is empty %}
			<p class="color-darkgrey">Il faut d'abord s'inscrire pour voir ses rendez-vous</p>
		{% else %}
			{% set nombreEntretiens = entreprisesSesEntretiens|length %}
			<ul class="etudMeetings">
				{% for key, entreprise in entreprisesSesEntretiens %}
					<li class="etudMeetings--item item-first">
						<p class="font-semibold etudMeetings--item--name">
							{{ entreprise.nom_entreprise }}
							-
							{{ entreprise.dpt_entreprise }}
						</p>
						{% if fichiersOffreSesEntretiens[key]|length == 1 %}
							<a class="etudMeetings--item--link" href="../assets/pdf/{{ fichiersOffreSesEntretiens[key][0] }}" target="_blank">
								Voir la fiche dâ€™offre ðŸ ’
							</a>
						{% else %}
							<a class="etudMeetings--item--link offres" href="#" data-popup="{{ key }}">
								Voir les fiches dâ€™offres ðŸ ’
							</a>
							<div class="link_offres etudMeetings__popup" style="display: none" data-popup-target="{{ key }}">
								<h4 class="etudMeetings__subtitle">{{ entreprise.nom_entreprise }}</h4>
								<ul>
									{% for fichier in fichiersOffreSesEntretiens[key] %}
										<li>
											<a class="etudMeetings--item--link" href="../assets/pdf/{{ fichier }}" target="_blank">Fiche d'offre
												{{ loop.index }}</a>
										</li>
									{% endfor %}
								</ul>
								<button class="cancel button-full-clear" data-popup-close="{{ key }}">
									Retour
								</button>
							</div>
						{% endif %}
						{% if dateActuelle > formation.date_fin_insc %}
						{% else %}
						<a class="etudMeetings--item--button button-full" href="{{ url('/etudiant/delete/' ~ entreprise.id_entreprise ~ '/' ~ etudiant.id_etudiant )}}">
							Supprimer
						</a>
						{% endif %}
					</li>
				{% endfor %}
			</ul>
		{% endif %}
	</section>

<section>
    <h2 class="etudMeetings--title">Les entretiens disponibles</h2>
    <ul>
        {% for key, entreprise in entreprisesPotentielEntretiens %}
            <li class="etudMeetings__new">
                <div class="etudMeetings__infos">
                    <h4 class="etudMeetings__subtitle">
                        {{ entreprise.nom_entreprise }} - {{ entreprise.dpt_entreprise }}
                    </h4>
                    {% if fichiersOffrePotentielEntretiens[key]|length == 1 %}
                        <a href="../assets/pdf/{{ fichiersOffrePotentielEntretiens[key][0] }}" target="_blank" class="etudMeetings__linkOffer">Voir la fiche d'offre ðŸ ’</a>
                    {% else %}
                        <a href="#" class="etudMeetings__linkOffer offres" data-popup="{{ key }}">Voir les fiches dâ€™offres ðŸ ’</a>
                        <div class="link_offres etudMeetings__popup" style="display: none" data-popup-target="{{ key }}">
                            <h4 class="etudMeetings__subtitle">{{ entreprise.nom_entreprise }}</h4>
                            <ul>
                                {% for fichier in fichiersOffrePotentielEntretiens[key] %}
                                    <li>
                                        <a class="etudMeetings--item--link" href="../assets/pdf/{{ fichier }}" target="_blank">Fiche d'offre {{ loop.index }}</a>
                                    </li>
                                {% endfor %}
                            </ul>
                            <button class="cancel button-full-clear" data-popup-close="{{ key }}">Retour</button>
                        </div>
                    {% endif %}
                </div>
                {% if dateActuelle >= formation.date_deb_insc and dateActuelle <= formation.date_fin_insc %}
                    {% if nombreEntretiens >= formation.nb_max_entretiens %}
                        <a href="#" class="button-full max_entretien_btn">M'inscrire</a>
                        <div class="max_entretien not-available" style="display: none">
                            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.713T12 15q-.425 0-.713.288T11 16q0 .425.288.713T12 17Zm-1-4h2V7h-2v6Zm1 9q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20Zm0-8Z"></path>
                            </svg>
                            <p>Inscription impossible !<br>Le nombre maximum d'entretiens possible est : {{ formation.nb_max_entretiens }}</p>
                            <button class="cancel-max_entretien button-full" data-popup-close="{{ key }}">Retour</button>
                        </div>
                    {% else %}
                        <a href="{{ url('/etudiant/add/' ~ entreprise.id_entreprise ~ '/' ~ etudiant.id_etudiant )}}" class="button-full">M'inscrire</a>
                    {% endif %}
                {% else %}
                    <div class="warning-inscription not-available" style="display: none">
                        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.713T12 15q-.425 0-.713.288T11 16q0 .425.288.713T12 17Zm-1-4h2V7h-2v6Zm1 9q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35-1.35 2.138 3.175T22 12q0-2.075-.788-3.9t-2.137-3.175q-1.35 1.35-3.175 2.138T12 22Zm0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20Zm0-8Z"></path>
                        </svg>
                        <p>Inscription impossible !<br>Merci de revenir le {{ formation.date_deb_insc }}.</p>
                        <button class="cancel-inscription button-full" data-popup-close="{{ key }}">Retour</button>
                    </div>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
</section>

	{% block scripts %}
		<script>
			document.addEventListener("DOMContentLoaded", function () {
const offres = document.querySelectorAll(".offres");
const popups = document.querySelectorAll(".link_offres");
const cancelButtons = document.querySelectorAll(".cancel");

offres.forEach((offre, index) => {
offre.addEventListener("click", function () {
const targetPopup = popups[index];
targetPopup.style.display = "flex";
});

cancelButtons.forEach((cancelButton, index) => {
cancelButton.addEventListener("click", function () {
const targetPopup = popups[index];
targetPopup.style.display = "none";
});
});
});

const inscriptionLinks = document.querySelectorAll(".inscription-inactive");
const warningMessages = document.querySelectorAll(".warning-inscription");
const cancelInscriptionButtons = document.querySelectorAll(".cancel-inscription");

inscriptionLinks.forEach((inscriptionLink, index) => {
inscriptionLink.addEventListener("click", function (event) {
event.preventDefault();
const targetWarning = warningMessages[index];
targetWarning.style.display = "flex";
});

cancelInscriptionButtons.forEach((cancelButton, index) => {
cancelButton.addEventListener("click", function () {
const targetWarning = warningMessages[index];
targetWarning.style.display = "none";
});
});
});

const max_entretien_btns = document.querySelectorAll(".max_entretien_btn");
const max_entretien = document.querySelectorAll(".max_entretien");
const cancelmax_entretiens = document.querySelectorAll(".cancel-max_entretien");

max_entretien_btns.forEach((max_entretien_btn, index) => {
max_entretien_btn.addEventListener("click", function (event) {
event.preventDefault();
const targetWarning = max_entretien[index];
targetWarning.style.display = "flex";
});

cancelmax_entretiens.forEach((cancelmax_entretien, index) => {
cancelmax_entretien.addEventListener("click", function () {
const targetWarning = max_entretien[index];
targetWarning.style.display = "none";
});
});
});

});
		</script>
	{% endblock %}
{% endblock %}
